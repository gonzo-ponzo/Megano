{% load static %}
{% load i18n %}
{% include 'base.html' with title='Оформление заказа' %}
<body class="Site">
    {% include 'header.html' %}

    <div class="Middle Middle_top">
        <div class="Middle-top">
            <div class="wrap">
                <div class="Middle-header">
                    <h1 class="Middle-title">{% trans 'Оформление заказа' %}
                    </h1>
                    <ul class="breadcrumbs Middle-breadcrumbs">
                        <li class="breadcrumbs-item"><a href="{% url 'main-page' %}">
                            {% trans "Главная" %}
                        </a>
                        </li>
                        <li class="breadcrumbs-item breadcrumbs-item_current">
                            <span>{% trans 'Оформление заказа' %}</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="Section Section_column Section_columnRight Section_columnWide Order">
            <div class="wrap">
                <div class="Section-column">
                    <div class="Section-columnSection">
                        <header class="Section-header">
                            <strong class="Section-title">
                                {% trans 'Прогресс заполнения' %}
                            </strong>
                        </header>
                        <div class="Section-columnContent">
                            <ul class="menu menu_vt Order-navigate">
                                <li class="menu-item_ACTIVE menu-item">
                                    <a class="menu-link" href="#step1">
                                        {% trans 'Шаг 1. Параметры пользователя' %}
                                    </a>
                                </li>
                                <li class="menu-item">
                                    <a class="menu-link" href="#step2">
                                        {% trans 'Шаг 2. Способ доставки' %}
                                    </a>
                                </li>
                                <li class="menu-item">
                                    <a class="menu-link" href="#step3">
                                        {% trans 'Шаг 3. Способ оплаты' %}
                                    </a>
                                </li>
                                <li class="menu-item">
                                    <a class="menu-link" href="#step4">
                                        {% trans 'Шаг 4. Подтверждение заказа' %}
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="Section-content">
                    <form class="form" action="#" method="post">
                        {% csrf_token %}
                        {{ order_form.non_field_errors }}

                        <div class="Order-block Order-block_OPEN" id="step1">
                            <header class="Section-header Section-header_sm">
                                <h2 class="Section-title">
                                    {% trans 'Шаг 1. Параметры пользователя' %}
                                </h2>
                            </header>
                            <div class="row">
                                <div class="row-block">
                                    {% include 'order/inc/_data_user.html' %}
                                </div>
                            </div>
                            <div class="Order-footer">
                                <a class="btn btn_success Order-next" href="#step2">
                                    {% trans 'Дальше' %}
                                </a>
                            </div>
                        </div>

                        <div class="Order-block" id="step2">
                            <header class="Section-header Section-header_sm">
                                <h2 class="Section-title">
                                    {% trans 'Шаг 2. Способ доставки' %}
                                </h2>
                            </header>

                            <div class="form-group">
                                <div>
                                    {{ order_form.delivery_type }}
                                </div>
                                <div class="custom-form-error">
                                    {{ order_form.delivery_type.errors }}
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="{{ order_form.city.id_for_label }}">
                                    {{ order_form.city.label }}
                                </label>
                                {{ order_form.city }}
                                <div class="custom-form-error">
                                    {{ order_form.city.errors }}
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label" for="{{ order_form.address.id_for_label }}">
                                    {{ order_form.address.label }}
                                </label>
                                {{ order_form.address }}
                                <div class="custom-form-error">
                                    {{ order_form.address.errors }}
                                </div>
                            </div>

                            <div class="Order-footer">
                                <a class="btn btn_success Order-next" href="#step3">
                                    {% trans 'Дальше' %}
                                </a>
                            </div>
                        </div>

                        <div class="Order-block" id="step3">
                            <header class="Section-header Section-header_sm">
                                <h2 class="Section-title">
                                    {% trans 'Шаг 3. Способ оплаты' %}
                                </h2>
                            </header>

                            <div class="form-group">
                                <div>
                                    {{ order_form.payment_type }}
                                </div>
                                <div class="custom-form-error">
                                    {{ order_form.payment_type.errors }}
                                </div>
                            </div>

                            <div class="Order-footer">
                                <a class="btn btn_success Order-next" href="#step4">
                                    {% trans 'Дальше' %}
                                </a>
                            </div>
                        </div>

                        <div class="Order-block" id="step4">
                            <header class="Section-header Section-header_sm">
                                <h2 class="Section-title">
                                    {% trans 'Шаг 4. Подтверждение заказа' %}
                                </h2>
                            </header>

                            <div class="Order-infoBlock">
                                <div class="Order-personal">
                                    <div class="row">
                                        <div class="row-block">
                                            {% include 'order/inc/_data_user.html' %}
                                        </div>
                                        <div class="row-block">
                                            <div class="Order-info Order-info_delivery">
                                                <div class="Order-infoType">
                                                    {% trans 'Тип доставки:' %}
                                                </div>
                                                <div class="Order-infoContent order-delivery"></div>
                                            </div>
                                            <div class="Order-info">
                                                <div class="Order-infoType">
                                                    {% trans 'Город:' %}
                                                </div>
                                                <div class="Order-infoContent order-city"></div>
                                            </div>
                                            <div class="Order-info">
                                                <div class="Order-infoType">
                                                    {% trans 'Адрес:' %}
                                                </div>
                                                <div class="Order-infoContent order-address"></div>
                                            </div>
                                            <div class="Order-info Order-info_pay">
                                                <div class="Order-infoType">
                                                    {% trans 'Оплата:' %}
                                                </div>
                                                <div class="Order-infoContent order-payment"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="Cart Cart_order">

                                    {% for product in order.products %}
                                        <div class="Cart-product">
                                            <div class="Cart-block Cart-block_row">
                                                <div class="Cart-block Cart-block_pict">

                                                    <a class="Cart-pict" href="{% url 'product-page' product.product_id %}">
                                                        <img class="Cart-img" src="/media/{{ product.product_image }}" alt="product"/>
                                                    </a>
                                                </div>
                                                <div class="Cart-block Cart-block_info">
                                                    <a class="Cart-title" href="{% url 'product-page' product.product_id %}">
                                                        {{ product.product_name }}
                                                    </a>
                                                </div>
                                                <div class="Cart-block Cart-block_price">
                                                    {% if product.discount == 0 %}
                                                        <div class="Cart-price">
                                                            {{ product.offer_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                        </div>
                                                    {% else %}
                                                        <div class="Cart-price_old">
                                                            {{ product.offer_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                        </div>
                                                        <div class="Cart-price">
                                                            {{ product.final_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                        </div>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="Cart-block Cart-block_row">
                                                <div class="Cart-block Cart-block_seller">
                                                    <div>
                                                        {% trans 'Продавец:' %}
                                                    </div>
                                                    <div>
                                                        <a href="{% url 'shop-detail' product.shop_id %}">
                                                            {{ product.shop_name }}
                                                        </a>
                                                    </div>
                                                </div>
                                                <div class="Cart-block Cart-block_amount">
                                                    {{ product.quantity }}&nbsp;{% trans 'шт.' %}
                                                </div>
                                            </div>
                                        </div>
                                    {% endfor %}

                                    <div class="order-total-normal order-total">
                                        {% with normal=order.total.normal %}
                                            <div class="Cart-total custom-Order-delivery">
                                                <div class="Cart-block Cart-block_total">
                                                    <strong class="Cart-title">
                                                        {% trans 'Доставка:' %}
                                                    </strong>
                                                    <span class="Cart-price">
                                                    {{ normal.delivery_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                </span>
                                                </div>
                                            </div>

                                            <div class="Cart-total custom-Order-total">
                                                <div class="Cart-block Cart-block_total">
                                                    <strong class="Cart-title">
                                                        {% trans 'Итого:' %}
                                                    </strong>
                                                    {% if normal.total_price == normal.full_total_price %}
                                                        <span class="Cart-price">
                                                            {{ normal.full_total_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                        </span>
                                                    {% else %}
                                                        <span class="Cart-price">
                                                            {{ normal.total_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                        </span>
                                                        <span class="Cart-price_old">
                                                            {{ normal.full_total_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                        </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        {% endwith %}
                                    </div>

                                    <div class="order-total-express">
                                        {% with express=order.total.express %}
                                            <div class="Cart-total custom-Order-delivery">
                                                <div class="Cart-block Cart-block_total">
                                                    <strong class="Cart-title">
                                                        {% trans 'Доставка:' %}
                                                    </strong>
                                                    <span class="Cart-price">
                                                    {{ express.delivery_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                </span>
                                                </div>
                                            </div>

                                            <div class="Cart-total custom-Order-total">
                                                <div class="Cart-block Cart-block_total">
                                                    <strong class="Cart-title">
                                                        {% trans 'Итого:' %}
                                                    </strong>
                                                    {% if express.total_price == express.full_total_price %}
                                                        <span class="Cart-price">
                                                            {{ express.full_total_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                        </span>
                                                    {% else %}
                                                        <span class="Cart-price">
                                                            {{ express.total_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                        </span>
                                                        <span class="Cart-price_old">
                                                            {{ express.full_total_price|floatformat:"-2" }}&nbsp;{% trans 'руб.' %}
                                                        </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        {% endwith %}
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label" for="{{ order_form.comment.id_for_label }}">
                                            Комментарий к заказу
                                        </label>
                                        {{ order_form.comment }}
                                        <div class="custom-form-error">
                                            {{ order_form.comment.errors }}
                                        </div>
                                    </div>

                                    <div class="Cart-total btn-Cart-total">
                                        <div class="Cart-block">
                                            <button class="btn btn_primary btn_lg" type="submit">
                                                {% trans 'Оплатить' %}
                                            </button>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    {% include 'footer.html' %}
    <script src="{% static 'plg/jQuery/jquery-3.5.0.slim.min.js' %}"></script>
    <script src="{% static 'plg/form/jquery.form.js' %}"></script>
    <script src="{% static 'plg/form/jquery.maskedinput.min.js' %}"></script>
    <script src="{% static 'plg/range/ion.rangeSlider.min.js' %}"></script>
    <script src="{% static 'plg/Slider/slick.min.js' %}"></script>
    <script src="{% static 'js/scripts.js' %}"></script>
</body>
